<!DOCTYPE html>
<html>
<head>
    <title>Continuous Network Testing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #testContainer {
            text-align: center;
            max-width: 800px;
        }

        #testChart {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="testContainer">
        <h1>Continuous Network Testing</h1>
        <div>
            <label for="websiteInput">Enter Website URL:</label>
            <input type="text" id="websiteInput" placeholder="https://example.com">
            <button onclick="startTesting()">Start Testing</button>
            <canvas id="testChart"></canvas>
        </div>
    </div>

    <script>
        const testChart = document.getElementById('testChart').getContext('2d');

        let testData = {
            labels: [],
            latency: [],
            packetLoss: [],
            jitter: []
        };

        let chartOptions = {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        };

        let myChart = new Chart(testChart, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Latency (ms)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                    data: []
                }, {
                    label: 'Packet Loss (%)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1,
                    data: []
                }, {
                    label: 'Jitter',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    data: []
                }]
            },
            options: chartOptions
        });

        function startTesting() {
            let websiteURL = document.getElementById('websiteInput').value;
            console.log('Testing website:', websiteURL);

            // TODO: Perform network testing and update chart
        }

        function updateChartData(latency, packetLoss, jitter) {
    let timeNow = new Date().toLocaleTimeString();
    testData.labels.push(timeNow);
    testData.latency.push(latency);
    testData.packetLoss.push(packetLoss);
    testData.jitter.push(jitter);

    // Remove old data if more than 10 points
    if (testData.labels.length > 10) {
        testData.labels.shift();
        testData.latency.shift();
        testData.packetLoss.shift();
        testData.jitter.shift();
    }

    // Update chart
    myChart.data.labels = testData.labels;
    myChart.data.datasets[0].data = testData.latency;
    myChart.data.datasets[1].data = testData.packetLoss;
    myChart.data.datasets[2].data = testData.jitter;

    // Check for packet loss and add red mark if detected
    if (packetLoss > 0) {
        let lossIndex = testData.packetLoss.findIndex(loss => loss > 0);
        if (lossIndex !== -1) {
            let datasetIndex = 1; // Index of packet loss dataset
            myChart.data.datasets[datasetIndex].pointBackgroundColor[lossIndex] = 'red';
        }
    }

    myChart.update();
}

    </script>
</body>
</html>
